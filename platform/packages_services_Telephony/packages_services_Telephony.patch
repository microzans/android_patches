From 6095c5e1a08934d1816efa8726f070954c4aee6c Mon Sep 17 00:00:00 2001
From: Danny Baumann <dannybaumann@web.de>
Date: Mon, 17 Nov 2014 12:47:51 +0100
Subject: [PATCH] Move lookup settings to dialer app (1/2)

Change-Id: Ieacfffcdbc6925eb3a062de74907c77a8bb0d989
---
 res/values/cm_arrays.xml                       |  55 ---------
 res/xml/call_feature_setting.xml               |  51 +--------
 src/com/android/phone/CallFeaturesSetting.java | 148 -------------------------
 src/com/android/phone/PhoneUtils.java          |  14 ---
 4 files changed, 1 insertion(+), 267 deletions(-)
 delete mode 100644 res/values/cm_arrays.xml

diff --git a/res/values/cm_arrays.xml b/res/values/cm_arrays.xml
deleted file mode 100644
index 0f5eec6..0000000
--- a/res/values/cm_arrays.xml
+++ /dev/null
@@ -1,55 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<!--
-     Copyright (C) 2014 The CyanogenMod Project
-
-     Licensed under the Apache License, Version 2.0 (the "License");
-     you may not use this file except in compliance with the License.
-     You may obtain a copy of the License at
-
-          http://www.apache.org/licenses/LICENSE-2.0
-
-     Unless required by applicable law or agreed to in writing, software
-     distributed under the License is distributed on an "AS IS" BASIS,
-     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-     See the License for the specific language governing permissions and
-     limitations under the License.
--->
-<resources xmlns:xliff="urn:oasis:names:tc:xliff:document:1.2">
-
-    <string-array name="forward_lookup_providers" translatable="false">
-        <item>Google</item>
-        <item>OpenStreetMap</item>
-    </string-array>
-
-    <string-array name="forward_lookup_provider_names" translatable="false">
-        <item>Google</item>
-        <item>OpenStreetMap</item>
-    </string-array>
-
-    <string-array name="people_lookup_providers" translatable="false">
-        <item>WhitePages</item>
-    </string-array>
-
-    <string-array name="people_lookup_provider_names" translatable="false">
-        <item>WhitePages (US)</item>
-    </string-array>
-
-    <string-array name="reverse_lookup_providers" translatable="false">
-        <item>OpenCnam</item>
-        <item>WhitePages</item>
-        <item>WhitePages_CA</item>
-        <item>YellowPages</item>
-        <item>YellowPages_CA</item>
-        <item>ZabaSearch</item>
-    </string-array>
-
-    <string-array name="reverse_lookup_provider_names" translatable="false">
-        <item>OpenCnam (US)</item>
-        <item>WhitePages (US)</item>
-        <item>WhitePages (CA)</item>
-        <item>YellowPages (US)</item>
-        <item>YellowPages (CA)</item>
-        <item>ZabaSearch (US)</item>
-    </string-array>
-
-</resources>
diff --git a/res/xml/call_feature_setting.xml b/res/xml/call_feature_setting.xml
index 6b9c347..00f691c 100644
--- a/res/xml/call_feature_setting.xml
+++ b/res/xml/call_feature_setting.xml
@@ -89,56 +89,7 @@
 
     </PreferenceScreen>
 
-    <PreferenceCategory
-        android:title="@string/number_lookup" />
-
-    <CheckBoxPreference
-        android:key="switch_enable_forward_lookup"
-        android:title="@string/enable_forward_lookup_title"
-        android:summary="@string/enable_forward_lookup_summary"
-        android:defaultValue="false"
-        android:persistent="false" />
-
-    <CheckBoxPreference
-        android:key="switch_enable_people_lookup"
-        android:title="@string/enable_people_lookup_title"
-        android:summary="@string/enable_people_lookup_summary"
-        android:defaultValue="false"
-        android:persistent="false" />
-
-    <CheckBoxPreference
-        android:key="switch_enable_reverse_lookup"
-        android:title="@string/enable_reverse_lookup_title"
-        android:summary="@string/enable_reverse_lookup_summary"
-        android:defaultValue="false"
-        android:persistent="false" />
-
-    <PreferenceScreen
-        android:title="@string/choose_lookup_providers"
-        android:persistent="false">
-
-        <ListPreference
-            android:key="button_choose_forward_lookup_provider"
-            android:title="@string/choose_forward_lookup_provider_title"
-            android:entries="@array/forward_lookup_provider_names"
-            android:entryValues="@array/forward_lookup_providers"
-            android:persistent="false" />
-
-        <ListPreference
-            android:key="button_choose_people_lookup_provider"
-            android:title="@string/choose_people_lookup_provider_title"
-            android:entries="@array/people_lookup_provider_names"
-            android:entryValues="@array/people_lookup_providers"
-            android:persistent="false" />
-
-        <ListPreference
-            android:key="button_choose_reverse_lookup_provider"
-            android:title="@string/choose_reverse_lookup_provider_title"
-            android:persistent="false" />
-
-    </PreferenceScreen>
-
-    <CheckBoxPreference
+     <CheckBoxPreference
         android:key="button_auto_retry_key"
         android:title="@string/auto_retry_mode_title"
         android:persistent="false"
diff --git a/src/com/android/phone/CallFeaturesSetting.java b/src/com/android/phone/CallFeaturesSetting.java
index 4c74c57..445c218 100644
--- a/src/com/android/phone/CallFeaturesSetting.java
+++ b/src/com/android/phone/CallFeaturesSetting.java
@@ -70,13 +70,10 @@ import com.android.phone.settings.AccountSelectionPreference;
 import com.android.services.telephony.sip.SipUtil;
 import com.android.internal.telephony.util.BlacklistUtils;
 
-import java.lang.String;
-import java.util.Arrays;
 import java.util.Collection;
 import java.util.HashMap;
 import java.util.HashSet;
 import java.util.Iterator;
-import java.util.LinkedList;
 import java.util.List;
 import java.util.Map;
 
@@ -199,19 +196,6 @@ public class CallFeaturesSetting extends PreferenceActivity
     private static final String BUTTON_SELECT_SUB_KEY  = "button_call_independent_serv";
     private static final String BUTTON_XDIVERT_KEY = "button_xdivert";
 
-    private static final String SWITCH_ENABLE_FORWARD_LOOKUP =
-            "switch_enable_forward_lookup";
-    private static final String SWITCH_ENABLE_PEOPLE_LOOKUP =
-            "switch_enable_people_lookup";
-    private static final String SWITCH_ENABLE_REVERSE_LOOKUP =
-            "switch_enable_reverse_lookup";
-    private static final String BUTTON_CHOOSE_FORWARD_LOOKUP_PROVIDER =
-            "button_choose_forward_lookup_provider";
-    private static final String BUTTON_CHOOSE_PEOPLE_LOOKUP_PROVIDER =
-            "button_choose_people_lookup_provider";
-    private static final String BUTTON_CHOOSE_REVERSE_LOOKUP_PROVIDER =
-            "button_choose_reverse_lookup_provider";
-
     private Intent mContactListIntent;
 
     /** Event for Async voicemail change call */
@@ -294,12 +278,6 @@ public class CallFeaturesSetting extends PreferenceActivity
     private AccountSelectionPreference mDefaultOutgoingAccount;
     private boolean isSpeedDialListStarted = false;
     private PreferenceScreen mButtonBlacklist;
-    private CheckBoxPreference mEnableForwardLookup;
-    private CheckBoxPreference mEnablePeopleLookup;
-    private CheckBoxPreference mEnableReverseLookup;
-    private ListPreference mChooseForwardLookupProvider;
-    private ListPreference mChoosePeopleLookupProvider;
-    private ListPreference mChooseReverseLookupProvider;
 
     private class VoiceMailProvider {
         public VoiceMailProvider(String name, Intent intent) {
@@ -658,14 +636,6 @@ public class CallFeaturesSetting extends PreferenceActivity
                 mChangingVMorFwdDueToProviderChange = true;
                 saveVoiceMailAndForwardingNumber(newProviderKey, newProviderSettings);
             }
-        } else if (preference == mEnableForwardLookup
-                || preference == mEnablePeopleLookup
-                || preference == mEnableReverseLookup) {
-            saveLookupProviderSwitch(preference, (Boolean) objValue);
-        } else if (preference == mChooseForwardLookupProvider
-                || preference == mChoosePeopleLookupProvider
-                || preference == mChooseReverseLookupProvider) {
-            saveLookupProviderSetting(preference, (String) objValue);
         }
         // always let the preference setting proceed.
         return true;
@@ -1754,50 +1724,6 @@ public class CallFeaturesSetting extends PreferenceActivity
             }
         }
 
-        mEnableForwardLookup = (CheckBoxPreference)
-                findPreference(SWITCH_ENABLE_FORWARD_LOOKUP);
-        mEnablePeopleLookup = (CheckBoxPreference)
-                findPreference(SWITCH_ENABLE_PEOPLE_LOOKUP);
-        mEnableReverseLookup = (CheckBoxPreference)
-                findPreference(SWITCH_ENABLE_REVERSE_LOOKUP);
-
-        mEnableForwardLookup.setOnPreferenceChangeListener(this);
-        mEnablePeopleLookup.setOnPreferenceChangeListener(this);
-        mEnableReverseLookup.setOnPreferenceChangeListener(this);
-
-        restoreLookupProviderSwitches();
-
-        mChooseForwardLookupProvider = (ListPreference)
-                findPreference(BUTTON_CHOOSE_FORWARD_LOOKUP_PROVIDER);
-        mChoosePeopleLookupProvider = (ListPreference)
-                findPreference(BUTTON_CHOOSE_PEOPLE_LOOKUP_PROVIDER);
-        mChooseReverseLookupProvider = (ListPreference)
-                findPreference(BUTTON_CHOOSE_REVERSE_LOOKUP_PROVIDER);
-
-        mChooseForwardLookupProvider.setOnPreferenceChangeListener(this);
-        mChoosePeopleLookupProvider.setOnPreferenceChangeListener(this);
-        mChooseReverseLookupProvider.setOnPreferenceChangeListener(this);
-
-        if (PhoneUtils.isPackageInstalled(this, getString(R.string.cyngn_reverse_lookup_provider_package))) {
-            List<String> reverseLookupProviders = new LinkedList<String>(Arrays.asList(getResources().getStringArray(R.array.reverse_lookup_provider_names)));
-            List<String> reverseLookupProvidersValues = new LinkedList<String>(Arrays.asList(getResources().getStringArray(R.array.reverse_lookup_providers)));
-
-            reverseLookupProviders.add(getString(R.string.cyngn_reverse_lookup_provider_name));
-            reverseLookupProvidersValues.add(getString(R.string.cyngn_reverse_lookup_provider_value));
-
-            String[] reverseLookupArray = new String[reverseLookupProviders.size()];
-            String[] reverseLookupNameArray = new String[reverseLookupProvidersValues.size()];
-            reverseLookupArray = reverseLookupProviders.toArray(reverseLookupArray);
-            reverseLookupNameArray = reverseLookupProvidersValues.toArray(reverseLookupNameArray);
-            mChooseReverseLookupProvider.setEntries(reverseLookupArray);
-            mChooseReverseLookupProvider.setEntryValues(reverseLookupNameArray);
-        } else {
-            mChooseReverseLookupProvider.setEntries(getResources().getStringArray(R.array.reverse_lookup_provider_names));
-            mChooseReverseLookupProvider.setEntryValues(getResources().getStringArray(R.array.reverse_lookup_providers));
-        }
-
-        restoreLookupProviders();
-
         // check the intent that started this activity and pop up the voicemail
         // dialog if we've been asked to.
         // If we have at least one non default VM provider registered then bring up
@@ -1883,9 +1809,6 @@ public class CallFeaturesSetting extends PreferenceActivity
                     BUTTON_VOICEMAIL_NOTIFICATION_VIBRATE_KEY + mPhone.getPhoneId(), false));
         }
 
-        restoreLookupProviderSwitches();
-        restoreLookupProviders();
-
         // Look up the voicemail ringtone name asynchronously and update its preference.
         new Thread(mVoicemailRingtoneLookupRunnable).start();
         updateBlacklistSummary();
@@ -2016,77 +1939,6 @@ public class CallFeaturesSetting extends PreferenceActivity
         }
     }
 
-    private void saveLookupProviderSwitch(Preference pref, Boolean newValue) {
-        if (DBG) log("saveLookupProviderSwitch()");
-
-        String key;
-
-        if (pref == mEnableForwardLookup) {
-            key = Settings.System.ENABLE_FORWARD_LOOKUP;
-        } else if (pref == mEnablePeopleLookup) {
-            key = Settings.System.ENABLE_PEOPLE_LOOKUP;
-        } else if (pref == mEnableReverseLookup) {
-            key = Settings.System.ENABLE_REVERSE_LOOKUP;
-        } else {
-            return;
-        }
-
-        Settings.System.putInt(getContentResolver(), key, newValue ? 1 : 0);
-    }
-
-    private void restoreLookupProviderSwitches() {
-        if (DBG) log("restoreLookupProviderSwitches()");
-
-        mEnableForwardLookup.setChecked(Settings.System.getInt(
-                getContentResolver(),
-                Settings.System.ENABLE_FORWARD_LOOKUP, 1) != 0);
-        mEnablePeopleLookup.setChecked(Settings.System.getInt(
-                getContentResolver(),
-                Settings.System.ENABLE_PEOPLE_LOOKUP, 1) != 0);
-        mEnableReverseLookup.setChecked(Settings.System.getInt(
-                getContentResolver(),
-                Settings.System.ENABLE_REVERSE_LOOKUP, 1) != 0);
-    }
-
-    private void restoreLookupProvider(ListPreference pref, String key) {
-        String provider = Settings.System.getString(getContentResolver(), key);
-        if (provider == null) {
-            pref.setValueIndex(0);
-            saveLookupProviderSetting(pref, pref.getEntryValues()[0].toString());
-        } else {
-            pref.setValue(provider);
-        }
-    }
-
-    private void restoreLookupProviders() {
-        if (DBG) log("restoreLookupProviders()");
-
-        restoreLookupProvider(mChooseForwardLookupProvider,
-                Settings.System.FORWARD_LOOKUP_PROVIDER);
-        restoreLookupProvider(mChoosePeopleLookupProvider,
-                Settings.System.PEOPLE_LOOKUP_PROVIDER);
-        restoreLookupProvider(mChooseReverseLookupProvider,
-                Settings.System.REVERSE_LOOKUP_PROVIDER);
-    }
-
-    private void saveLookupProviderSetting(Preference pref, String newValue) {
-        if (DBG) log("saveLookupProviderSetting()");
-
-        String key;
-
-        if (pref == mChooseForwardLookupProvider) {
-            key = Settings.System.FORWARD_LOOKUP_PROVIDER;
-        } else if (pref == mChoosePeopleLookupProvider) {
-            key = Settings.System.PEOPLE_LOOKUP_PROVIDER;
-        } else if (pref == mChooseReverseLookupProvider) {
-            key = Settings.System.REVERSE_LOOKUP_PROVIDER;
-        } else {
-            return;
-        }
-
-        Settings.System.putString(getContentResolver(), key, newValue);
-    }
-
     /**
      * Enumerates existing VM providers and puts their data into the list and populates
      * the preference list objects with their names.
diff --git a/src/com/android/phone/PhoneUtils.java b/src/com/android/phone/PhoneUtils.java
index 783844e..7190d86 100644
--- a/src/com/android/phone/PhoneUtils.java
+++ b/src/com/android/phone/PhoneUtils.java
@@ -25,8 +25,6 @@ import android.content.ComponentName;
 import android.content.Context;
 import android.content.DialogInterface;
 import android.content.Intent;
-import android.content.pm.PackageInfo;
-import android.content.pm.PackageManager;
 import android.content.res.Configuration;
 import android.media.AudioManager;
 import android.net.Uri;
@@ -2479,16 +2477,4 @@ public class PhoneUtils {
             || network == Phone.NT_MODE_LTE_GSM_WCDMA
             || network == Phone.NT_MODE_LTE_CDMA_AND_EVDO);
     }
-
-    public static boolean isPackageInstalled(Context context, String pkg) {
-        if (pkg == null) {
-            return false;
-        }
-        try {
-            PackageInfo pi = context.getPackageManager().getPackageInfo(pkg, 0);
-            return pi.applicationInfo.enabled;
-        } catch (PackageManager.NameNotFoundException e) {
-            return false;
-        }
-    }
 }
-- 
1.9.3 (Apple Git-50)

